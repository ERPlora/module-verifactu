{% load static %}
{% load i18n %}

{% if request.htmx %}
<div id="dashboard-tabbar" hx-swap-oob="innerHTML">
<ion-footer>
{% include "verifactu/partials/tabbar.html" with current_view='records' %}
</ion-footer>
</div>
{% endif %}

<div class="ion-padding">
    <!-- Page Header -->
    <div class="flex justify-between items-center mb-6">
        <div>
            <h1 class="text-2xl font-bold" style="color: var(--ion-text-color);">{% trans "Verifactu Records" %}</h1>
            <p class="text-sm mt-1" style="color: var(--ion-color-medium);">{% trans "All invoice records submitted to AEAT" %}</p>
        </div>
    </div>

    <!-- Filters -->
    <ion-card class="m-0 mb-4">
        <ion-card-content>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <ion-item>
                    <ion-input
                        label="{% trans 'Search' %}"
                        label-placement="stacked"
                        placeholder="{% trans 'Invoice number, NIF...' %}"
                        value="{{ search }}"
                        name="search"
                        hx-get="{% url 'verifactu:records' %}"
                        hx-target="#records-table-container"
                        hx-trigger="input changed delay:500ms"
                        hx-include="[name='status'], [name='type']">
                    </ion-input>
                </ion-item>
                <ion-item>
                    <ion-select
                        label="{% trans 'Status' %}"
                        label-placement="stacked"
                        placeholder="{% trans 'All' %}"
                        name="status"
                        value="{{ status_filter }}"
                        hx-get="{% url 'verifactu:records' %}"
                        hx-target="#records-table-container"
                        hx-trigger="ionChange"
                        hx-include="[name='search'], [name='type']">
                        <ion-select-option value="">{% trans "All" %}</ion-select-option>
                        {% for value, label in status_choices %}
                        <ion-select-option value="{{ value }}">{{ label }}</ion-select-option>
                        {% endfor %}
                    </ion-select>
                </ion-item>
                <ion-item>
                    <ion-select
                        label="{% trans 'Type' %}"
                        label-placement="stacked"
                        placeholder="{% trans 'All' %}"
                        name="type"
                        value="{{ record_type }}"
                        hx-get="{% url 'verifactu:records' %}"
                        hx-target="#records-table-container"
                        hx-trigger="ionChange"
                        hx-include="[name='search'], [name='status']">
                        <ion-select-option value="">{% trans "All" %}</ion-select-option>
                        {% for value, label in type_choices %}
                        <ion-select-option value="{{ value }}">{{ label }}</ion-select-option>
                        {% endfor %}
                    </ion-select>
                </ion-item>
            </div>
        </ion-card-content>
    </ion-card>

    <!-- Records Table -->
    <ion-card class="m-0">
        <ion-card-content class="p-0">
            <div id="records-table-container">
                {% include "verifactu/partials/records_table.html" %}
            </div>
        </ion-card-content>
    </ion-card>
</div>
